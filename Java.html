<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Java</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Java</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_servlet_jsp_基础">1. Servlet &amp; JSP 基础</a>
<ul class="sectlevel2">
<li><a href="#_请求响应会话等">1.1. 请求、响应、会话等</a></li>
<li><a href="#_jsp基本用法">1.2. JSP基本用法</a></li>
<li><a href="#_无脚本的jsp">1.3. 无脚本的JSP</a></li>
<li><a href="#_jstl">1.4. JSTL</a></li>
<li><a href="#_定制标记开发">1.5. 定制标记开发</a></li>
<li><a href="#_web应用部署">1.6. Web应用部署</a></li>
<li><a href="#_web应用安全">1.7. Web应用安全</a></li>
<li><a href="#_过滤器和包装器">1.8. 过滤器和包装器</a></li>
<li><a href="#_模式和struts">1.9. 模式和struts</a></li>
<li><a href="#_环境变量设置">1.10. 环境变量设置</a></li>
<li><a href="#_其他">1.11. 其他</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_servlet_jsp_基础">1. Servlet &amp; JSP 基础</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_请求响应会话等">1.1. 请求、响应、会话等</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>只有 请求属性 和 局部变量 是线程安全的。</p>
</li>
<li>
<p>RequestDispatcher</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>两种获得方法</p>
<div class="listingblock">
<div class="content">
<pre>//1.从ServletRequest获得
RequestDispatcher view = request.getRequestDispatcher("result.jsp");

//2.从ServletContext获得，不能指定相对路径，路径必须以【斜线】开头
RequestDispatcher view = getServletContext().getRequestDispatcher("/result.jsp");</pre>
</div>
</div>
</li>
<li>
<p>只有2个方法</p>
<div class="listingblock">
<div class="content">
<pre>//常用，转发请求
forward()

//不常用，转发请求，处理完后再返回发送者
include()</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>如果已经提交了响应，就不能再转发请求。</p>
</li>
<li>
<p>会话关联URL要点</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在写至响应的HTML中，URL重写把会话ID增加到其中所有URL的最后。</p>
</li>
<li>
<p>会话ID作为请求URL最后的“额外”信息再通过请求返回。</p>
</li>
<li>
<p>如果客户不接受cookie，URL重写会自动发生，但是必须显式地对所有URL编码。</p>
</li>
<li>
<p>要对一个URL编码，需要调用response.encodeURL(aString)。</p>
</li>
<li>
<p>没有办法对静态页面完成自动的URL重写，所以，如果依赖于会话，就必须使用动态生成的页面。</p>
</li>
</ol>
</div>
</li>
<li>
<p>会话有3种死法：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>超时</p>
</li>
<li>
<p>在会话对象上调用invalidate()。</p>
</li>
<li>
<p>应用结束（崩溃或取消部署）。</p>
</li>
</ol>
</div>
</li>
<li>
<p>设置会话超时</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在DD（deployment descriptor）中配置会话超时</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app ...&gt;
    &lt;servlet&gt;
    ...
    &lt;/servlet&gt;
    &lt;session-config&gt;
        &lt;!-- 以分钟为单位 --&gt;
        &lt;session-timeout&gt;15&lt;/session-timeout&gt;
    &lt;/session-config&gt;
&lt;/web-app&gt;</pre>
</div>
</div>
</li>
<li>
<p>设定一个特定会话的会话超时</p>
<div class="listingblock">
<div class="content">
<pre>//以秒为单位，设为0时表示立即超时
session.setMaxInactiveInterval(20*60);</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>设置cookie在客户端上的存活时间</p>
<div class="listingblock">
<div class="content">
<pre>//以秒为单位。若设为-1，浏览器退出时cookie即消失。
cookie.setMaxAge(30*60);</pre>
</div>
</div>
</li>
<li>
<p>从客户请求得到cookie（或多个cookie）</p>
<div class="listingblock">
<div class="content">
<pre>//没有getCookie(String)方法，只能得到一个数组，然后循环处理。
Cookie[] cookies = request.getCookies();
if ( cookies != null ) {
    for (int i = 0; i &lt; cookies.length; i++) {
        Cookie cookie = cookies[i];
        if (cookie.getName().equals("username")) {
            String userName = cookie.getValue();
            out.println("Hello " + userName);
            break;
        }
    }
}</pre>
</div>
</div>
</li>
<li>
<p>Cookie和首部的区别</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>向响应增加一个首部时，名和值String作为参数传入。</p>
<div class="listingblock">
<div class="content">
<pre>response.addHeader("foo", "bar");</pre>
</div>
</div>
</li>
<li>
<p>向响应增加一个Cookie时，要传递一个Cookie对象。</p>
<div class="listingblock">
<div class="content">
<pre>Cookie cookie = new Cookie("name", name);
response.addCookie(cookie);</pre>
</div>
</div>
</li>
<li>
<p>首部既有setHeader()方法，又有addHeader()方法，替换现有值或增加一个值。</p>
</li>
<li>
<p>不存在setCookie()方法，只有addCookie()方法。</p>
</li>
</ol>
</div>
</li>
<li>
<p>监听者类型</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">里程碑</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事件和监听者类型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">生命周期 - 创建/撤销 会话</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionEvent HttpSessionListener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性 - 增加/删除/替换 属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionBindingEvent HttpSessionAttributeListener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">迁移 - 会话准备钝化/会话已经激活</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionEvent HttpSessionActivationListener</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上述3个监听者必须在DD中注册，但HttpSessionBindingListener不在DD中配置。</p>
</div>
</li>
<li>
<p>只有HttpSession对象（及其属性）会从一个VM移到另一个VM。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>每个VM中有一个ServletContext。</p>
</li>
<li>
<p>每个VM上的每个Servlet都有一个ServletConfig。</p>
</li>
<li>
<p>对于每个Web应用的一个给定的会话ID，只有一个HttpSession对象，而不论应用分布在多少个VM上。</p>
</li>
</ol>
</div>
</li>
<li>
<p>与会话有关的监听者</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">场景</th>
<th class="tableblock halign-left valign-top">监听者接口/方法</th>
<th class="tableblock halign-left valign-top">事件类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">有多少个并发用户（活动的会话）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionListener(javax.servlet.http) sessionCreated sessionDestroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionEvent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会话何时从一个VM移到另一个VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionActivationListener(javax.servlet.http) sessionDidActivate sessionWillPassivate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionEvent(注意:没有特定的HttpSessionActivationEvent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">有一个属性类(对象作为一个属性值)，此类对象绑定到会话或从会话删除时得到通知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionBindingListener(javax.servlet.http) valueBound valueUnbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionBindingEvent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会话什么时候增加、删除或替换会话属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionAttributeListener(javax.servlet.http) attributeAdded attributeRemoved attributeReplaced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSessionBindingEvent(注意:没有特定的HttpSessionAttributeEvent)</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jsp基本用法">1.2. JSP基本用法</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JSP隐式对象</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">隐式对象</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JspWriter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpServletRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpServletResponse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throwable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exception</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PageContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pageContext</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">page</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>JspWriter与从HttpServletResponse得到的PrintWriter类似，增加了一些缓冲功能。</p>
</div>
</li>
<li>
<p>JSP中的两种注释</p>
<div class="listingblock">
<div class="content">
<pre>&lt;!-- HTML注释 --&gt;
&lt;%-- JSP注释 --%&gt;</pre>
</div>
</div>
</li>
<li>
<p>容器根据JSP生成一个类，这个类实现了HttpJspPage接口，有3个关键方法：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>jspInit()，可以覆盖</p>
</li>
<li>
<p>jspDestroy()，可以覆盖</p>
</li>
<li>
<p>_jspService()，不能覆盖</p>
</li>
</ol>
</div>
</li>
<li>
<p>属性设置：servlet VS JSP</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">servlet</th>
<th class="tableblock halign-left valign-top">JSP(隐式对象)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getServletContext().setAttribute(“foo”, barObj);</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.setAttribute(“foo”, barObj);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request.setAttribute(“foo”, barObj);</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request.setAttribute(“foo”, barObj);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会话</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request.getSession().setAttribute(“foo”, barObj);</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session.setAttribute(“foo”, barObj);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">页面</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用！</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pageContext.setAttribute(“foo”, barObj);</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>注意“ServletContext”这个容易误导的命名，没有“上下文”、只有“应用”。</p>
</div>
</li>
<li>
<p>pageContext 获取/设置 属性示例</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- pageContext对应页面作用域，有两个重载的getAttribute()，
一个String参数的为默认，String+int 参数的可以取其他作用域的属性。 --%&gt;

&lt;%-- 设置一个页面作用域属性 --%&gt;
&lt;% Float one = new Float(42.5); %&gt;
&lt;% pageContext.setAttribute("foo", one); %&gt;

&lt;%-- 获得一个页面作用域属性 --%&gt;
&lt;%= pageContext.getAttribute("foo") %&gt;

&lt;%-- 设置一个会话作用域属性 --%&gt;
&lt;% Float two = new Float(22.4); %&gt;
&lt;% pageContext.setAttribute("foo", two, PageContext.SESSION_SCOPE); %&gt;

&lt;%-- 获得一个会话作用域属性 --%&gt;
&lt;%= pageContext.getAttribute("foo", PageContext.SESSION_SCOPE) %&gt;
&lt;%-- 等价于 --%&gt;
&lt;%= session.getAttribute("foo") %&gt;

&lt;%-- 获得一个应用作用域属性 --%&gt;
&lt;%= pageContext.getAttribute("mail", pageContext.APPLICATION_SCOPE) %&gt;
&lt;%-- 等价于 --%&gt;
&lt;%= application.getAttribute("mail") %&gt;

&lt;%-- 不知道作用域，也可以查找属性。
查找顺序：页面作用域-&gt;请求作用域-&gt;会话作用域-&gt;应用作用域。
在一个作用域中找到即不再继续。 --%&gt;
&lt;%= pageContext.findAttribute("foo") %&gt;</pre>
</div>
</div>
</li>
<li>
<p>JSP指令</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>page</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>import 属性</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>java.lang、javax.servlet、javax.servlet.http、javax.servlet.jsp 将自动默认添加。</p>
</li>
</ol>
</div>
</li>
<li>
<p>isThreadSafe 属性</p>
</li>
<li>
<p>contentType 属性</p>
</li>
<li>
<p>isELIgnored 属性</p>
</li>
<li>
<p>isErrorPage 属性</p>
</li>
<li>
<p>errorPage 属性</p>
</li>
<li>
<p>language 属性</p>
</li>
<li>
<p>extends 属性</p>
</li>
<li>
<p>session 属性</p>
</li>
<li>
<p>buffer 属性</p>
</li>
<li>
<p>autoFlush 属性</p>
</li>
<li>
<p>info 属性</p>
</li>
<li>
<p>pageEncoding 属性</p>
</li>
</ol>
</div>
</li>
<li>
<p>taglib</p>
</li>
<li>
<p>include</p>
</li>
</ol>
</div>
</li>
<li>
<p>在DD中使用 &lt;scripting-invalid&gt; 禁用脚本元素</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app ...&gt;
    ...
    &lt;jsp-config&gt;
        &lt;jsp-property-group&gt;
        &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
        &lt;scripting-invalid&gt;
            true
        &lt;/scripting-invalid&gt;
        &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;
    ...
&lt;/web-app&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注意，JSP规范中已经 删除 了如下指令属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ page isScriptingEnabled="false" %&gt;</pre>
</div>
</div>
</li>
<li>
<p>EL默认启用，如果需要忽略EL，可以在DD中使用&lt;el-ignored&gt; 或者在JSP中使用 isELIgnored page指令属性。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app ...&gt;
    ...
    &lt;jsp-config&gt;
        &lt;jsp-property-group&gt;
        &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
        &lt;el-ignored&gt;
            true
        &lt;/el-ignored&gt;
        &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;
    ...
&lt;/web-app&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ page isELIgnored="true" %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注意：如果以上两者冲突，page指令优先于DD设置。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_无脚本的jsp">1.3. 无脚本的JSP</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JavaBean标准动作</p>
<div class="listingblock">
<div class="content">
<pre>&lt;jsp:useBean&gt;
&lt;jsp:getProperty&gt;
&lt;jsp:setProperty&gt;</pre>
</div>
</div>
</li>
<li>
<p>JavaBean 和 EnterpriseJavaBean（EJB）不同，使用规则如下：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>必须有一个无参数的公共构造函数。</p>
</li>
<li>
<p>必须按命名约定来命名公共的获取方法和设置方法：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>首先是 get 和 set ，如果是布尔类property，获取方法的前缀为 is。后面跟同一个词，例如：getFoo(), setFoo()</p>
</li>
<li>
<p>要得到property名，先去掉 get 和 set，再把余下部分的第一个字母变成小写。</p>
</li>
</ol>
</div>
</li>
<li>
<p>设置方法的参数类型和获取方法的返回类型必须一样。</p>
</li>
<li>
<p>property名和类型是由获取方法和设置方法得出，而不是得自于类中的一个成员。</p>
</li>
<li>
<p>结合JSP使用时，property类型必须是String，或者是一个基本类型。</p>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;jsp:useBean&gt;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>&lt;jsp:useBean&gt;体中的代码会有条件的运行，只有找不到bean而且创建一个新bean时才会运行。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;jsp:useBean id="person" class="foo.Person" scope="page" &gt;
         &lt;jsp:setProperty name="person" property="name" value="Fred" /&gt;
&lt;/jsp:useBean &gt;</pre>
</div>
</div>
</li>
<li>
<p>type==引用类型（可以是抽象类），class==对象类型（必须是具体类）。</p>
<div class="listingblock">
<div class="content">
<pre>type x = new class()</pre>
</div>
</div>
</li>
<li>
<p>如果使用了type，但没有class，bean必须已经存在。</p>
</li>
<li>
<p>如果使用了class（有或没有type），class不能是抽象类，而且必须有一个无参数的公共构造函数。</p>
</li>
<li>
<p>scope属性默认为“page”</p>
</li>
<li>
<p>利用param属性，可以把bean的property value设置为一个请求参数的值。只需指定请求参数。</p>
</li>
<li>
<p>如果请求参数名与bean的property name匹配，就不需要在&lt;jsp:setProperty&gt;标记中为该property指定值。</p>
</li>
<li>
<p>如果所有请求参数名都与bean的property name匹配，可以按如下处理（设为*号）：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;jsp:useBean id="person" type="foo.Person" class="foo.Employee"&gt;
         &lt;jsp:setProperty name="person" property="*"&gt;
&lt;/jsp:useBean&gt;</pre>
</div>
</div>
</li>
<li>
<p>Bean标记会自动转换String或基本类型的property。</p>
</li>
<li>
<p>如果使用脚本，就不会自动完成String到基本类型的转换。即使表达式在&lt;jsp:setProperty&gt;标记中也会失败。</p>
</li>
<li>
<p>利用&lt;jsp:getProperty&gt;只能访问bean属性的property，不能访问嵌套的property。
（例如property不是String或基本类型，而是Object类型。）可以使用表达式语言（EL）解决问题，例如：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;html&gt;&lt;body&gt;
         Dog's name is: ${person.dog.name}
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>EL隐式对象</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>pageScope</p>
</li>
<li>
<p>requestScope</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>requestScope不是请求对象，只是请求作用域属性的一个Map。可以使用 ${pageContext.request.method}来得到请求对象的方法。</p>
</li>
</ol>
</div>
</li>
<li>
<p>sessionScope</p>
</li>
<li>
<p>applicationScope</p>
</li>
<li>
<p>param</p>
</li>
<li>
<p>paramValues</p>
</li>
<li>
<p>header</p>
</li>
<li>
<p>headerValues</p>
</li>
<li>
<p>cookie</p>
</li>
<li>
<p>initParam</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>servlet初始化参数由&lt;init-param&gt;配置，上下文参数由&lt;context-param&gt;配置。EL中隐式对象 initParam 对应的是 上下文参数。</p>
</li>
</ol>
</div>
</li>
<li>
<p>pageContext</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>唯一不是映射的对象，是pageContext对象的实际引用，是一个JavaBean。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>EL操作符和保留字</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>最常用的是点号(.)和中括号([])，以下两行代码等价：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- bean和Map可使用点号(.) --%&gt;

${person.name}

&lt;%-- bean、Map、List、数组等都可以使用[]。
     中括号左边是一个List或数组时，且索引是一个String直接量，则索引会自动强制转换为int。
     如果中括号里没有引号（不是String直接量），容器就会计算其中的内容。
     在中括号里可以使用嵌套表达式，深度不限。
--%&gt;

${person["name"]}</pre>
</div>
</div>
</li>
<li>
<p>算术操作符（5个）</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>加法：+</p>
</li>
<li>
<p>减法：-</p>
</li>
<li>
<p>乘法：*</p>
</li>
<li>
<p>除法：/ 和 div （可以除0，得 Infinity）</p>
</li>
<li>
<p>取模：% 和 mod</p>
</li>
</ol>
</div>
</li>
<li>
<p>逻辑操作符（3个）</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>与：&amp;&amp; 和 and</p>
</li>
<li>
<p>或：|| 和 or</p>
</li>
<li>
<p>非：! 和 not</p>
</li>
</ol>
</div>
</li>
<li>
<p>关系操作符（6个）</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>等于：== 和 eq</p>
</li>
<li>
<p>不等于：!= 和 ne</p>
</li>
<li>
<p>小于：&lt; 和 lt</p>
</li>
<li>
<p>大于：&gt; 和 gt</p>
</li>
<li>
<p>小于等于：&#8656; 和 le</p>
</li>
<li>
<p>大于等于：&gt;= 和 ge</p>
</li>
</ol>
</div>
</li>
<li>
<p>保留字</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>true/false</p>
</li>
<li>
<p>null</p>
</li>
<li>
<p>instanceof</p>
</li>
<li>
<p>empty</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>要在JSP中使用函数，必须使用 taglib 指令声明一个命名空间。在 taglib 指令中放一个 prefix 属性，
告诉容器你要调用的函数在哪个TLD里能找到。例如：</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ taglib prefix="mine" uri="/WEB-INF/foo.tld" %&gt;</pre>
</div>
</div>
</li>
<li>
<p>EL函数可以有参数，但TLD中要为每个参数指定完全限定名（除非是一个基本类型）。</p>
<div class="paragraph">
<p>例如，如果函数取一个Map参数，则应当是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;function-signature&gt;
         int rollDice(java.util.Map)
&lt;/function-signature&gt;</pre>
</div>
</div>
</li>
<li>
<p>EL能妥善处理null值，即使找不到表达式中指定名的属性/性质/键，也能正常显示页面。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>算术表达式中，EL把null值看作“0”。</p>
</li>
<li>
<p>逻辑表达式中，EL把null值看作“false”。</p>
</li>
</ol>
</div>
</li>
<li>
<p>可重用的模板部件</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>include 指令，在转换时插入”Header.jsp”的源代码。</p>
<div class="listingblock">
<div class="content">
<pre>...
&lt;%@ include file="Header.jsp" %&gt;
...</pre>
</div>
</div>
</li>
<li>
<p>&lt;jsp:include&gt;标准动作，在运行时插入“Header.jsp”的响应。</p>
<div class="listingblock">
<div class="content">
<pre>...
&lt;jsp:include page="Header.jsp" /&gt;
...</pre>
</div>
</div>
</li>
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;jsp:include&gt;标准动作会带来额外的性能开销，但总能保证有最新内容。</p>
</li>
<li>
<p>使用include指令时，Tomcat也可以自动检测到所包含文件发生了变化。问题是，规范并不保证这一点，如果代码全依赖于此，
应用就不一定能够顺利移植到其他容器。</p>
</li>
<li>
<p>两者都是位置敏感的。</p>
</li>
<li>
<p>虽然include指令是静态的，但是如果所包含的东西是动态的，每次访问页面时，所包含的东西会动态运行。</p>
</li>
<li>
<p>全部源代码都会粘贴，不要把开始和结束HTML、BODY标记放在可重用部件中。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>使用&lt;jsp:param&gt;定制包含的内容</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>笨方法：把定制内容放在主页面上。</p>
</li>
<li>
<p>好方法：把定制内容作为请求参数传递给所包含的页面。例如：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>完成包含的JSP</p>
<div class="listingblock">
<div class="content">
<pre>&lt;html&gt;&lt;body&gt;

&lt;jsp:include page="Header.jsp" &gt;
    &lt;jsp:param name="subTitle" value="xxxxx" /&gt;
&lt;/jsp:include&gt;

&lt;br&gt;
&lt;em&gt;Web Services Support Group.&lt;/em&gt; &lt;br&gt;&lt;br&gt;
Contact us at: ${initParam.mainEmail}
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>使用新参数的被包含页眉（Header.jsp）</p>
<div class="listingblock">
<div class="content">
<pre>&lt;img src="images/Web-Services.jpg" &gt; &lt;br&gt;
&lt;em&gt;&lt;strong&gt;${param.subTitle}&lt;/strong&gt;&lt;/em&gt; &lt;br&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>注意：这种使用参数的方法对于include指令没有意义（因为不是动态的），只适用于&lt;jsp:include&gt;标准动作。</p>
</div>
</li>
<li>
<p>利用&lt;jsp:forward&gt;标准动作有条件的转发</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>提供转发条件的JSP（Hello.jsp）</p>
<div class="listingblock">
<div class="content">
<pre>&lt;html&gt;&lt;body&gt;
Welcome to our page!
&lt;% if (request.getParameter("userName") == null) { %&gt;
    &lt;jsp:forward page="HandleIt.jsp" /&gt;
&lt;% } %&gt;
Hello ${param.userName}
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>请求转发到的目标JSP（HandleIt.jsp）</p>
<div class="listingblock">
<div class="content">
<pre>&lt;html&gt;&lt;body&gt;
We're sorry... you need to log in again.

&lt;form action="Hello.jsp" method="get"&gt;
Name: &lt;input name="userName" type="text"&gt;
&lt;input name="Submit" type="submit"&gt;
&lt;/form&gt;

&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>注意：缓冲区会在转发前清空，不要先刷新输出（out.flush()）再转发。</p>
</li>
<li>
<p>不用脚本就完成条件转发的例子（使用JSTL）：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;html&gt;&lt;body&gt;
Welcome to our page!

&lt;c:if test="${empty param.userName}" &gt;
    &lt;jsp:forward page="HandleIt.jsp" /&gt;
&lt;/c:if&gt;

Hello ${param.userName}
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jstl">1.4. JSTL</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JSTL 1.1版有5个库，其中4个是定制标记库，列出标记如下：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>核心库</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>通用：&lt;c:out&gt; &lt;c:set&gt; &lt;c:remove&gt; &lt;c:catch&gt;</p>
</li>
<li>
<p>条件：&lt;c:if&gt; &lt;c:choose&gt; &lt;c:when&gt; &lt;c:otherwise&gt;</p>
</li>
<li>
<p>与URL相关：&lt;c:import&gt; &lt;c:url&gt; &lt;c:redirect&gt; &lt;c:param&gt;</p>
</li>
<li>
<p>循环：&lt;c:forEach&gt; &lt;c:forTokens&gt;</p>
</li>
</ol>
</div>
</li>
<li>
<p>格式化库</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>国际化：&lt;fmt:message&gt; &lt;fmt:setLocale&gt; &lt;fmt:bundle&gt; &lt;fmt:setBundle&gt; &lt;fmt:param&gt; &lt;fmt:requestEncoding&gt;</p>
</li>
<li>
<p>格式化：&lt;fmt:timeZone&gt; &lt;fmt:setTimeZone&gt; &lt;fmt:formatNumber&gt; &lt;fmt:parseNumber&gt; &lt;fmt:parseDate&gt;</p>
</li>
</ol>
</div>
</li>
<li>
<p>SQL库</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>数据库访问：&lt;sql:query&gt; &lt;sql:update&gt; &lt;sql:setDataSource&gt; &lt;sql:param&gt; &lt;sql:dateParam&gt;</p>
</li>
</ol>
</div>
</li>
<li>
<p>XML库</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>核心XML动作：&lt;x:parse&gt; &lt;x:out&gt; &lt;x:set&gt;</p>
</li>
<li>
<p>XML流控制：&lt;x:if&gt; &lt;x:choose&gt; &lt;x:when&gt; &lt;x:otherwise&gt; &lt;x:forEach&gt;</p>
</li>
<li>
<p>转换动作：&lt;x:transform&gt; &lt;x:param&gt;</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:…&gt;标记中，前缀不一定用“c（core）”，但这是一个标准的约定，建议采用。</p>
</li>
<li>
<p>&lt;c:out&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>使用escapeXml属性（默认为true），显式地声明（不）转换XML实体。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;div class='tipBox'&gt;
    &lt;b&gt;Tip of the Day:&lt;/b&gt; &lt;br/&gt; &lt;br/&gt;
    &lt;c:out value='${pageContent.currentTip}' escapeXml='false' /&gt;
&lt;/div&gt;</pre>
</div>
</div>
</li>
<li>
<p>哪些HTML特殊字符需要转换？ 只有5个：</p>
<div class="listingblock">
<div class="content">
<pre>&lt; 	&amp;lt;
&gt; 	&amp;gt;
&amp; 	&amp;amp;
‘ 	&amp;#039;
“ 	&amp;#034;</pre>
</div>
</div>
</li>
<li>
<p>Null值呈现为空文本，可用default属性设置一个默认值。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;b&gt;Hello &lt;c:out value='${user}' default='guest' /&gt;.&lt;/b&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;b&gt;Hello &lt;c:out value='${user}'&gt;guest&lt;/c:out&gt;.&lt;/b&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:forEach&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>var为变量，items为集合，varStatus为循环计数器。var作用域仅限于标记内部。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:forEach var="movie" items="${movieList}" varStatus="movieLoopCount" &gt;
...
&lt;/c:forEach&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;c:forEach&gt;标记可以嵌套。</p>
</li>
<li>
<p>可选的属性还有 begin 、end 、step 等，查询 JSTL 规范可以获取所有属性的细节。</p>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:if&gt;标记</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:if test="${userType eq 'member' }" &gt;
    &lt;jsp:include page="inputComments.jsp" /&gt;
&lt;/c:if&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;c:choose&gt;标记、&lt;c:when&gt;标记、&lt;c:otherwise&gt;标记</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:choose&gt;
    &lt;c:when test="${userPref == 'performance'}"&gt;
        ...
    &lt;/c:when&gt;
    &lt;c:when test="${userPref == 'safety'}"&gt;
        ...
    &lt;/c:when&gt;
    &lt;c:when test="${userPref == 'maintenance'}"&gt;
        ...
    &lt;/c:when&gt;

    &lt;c:otherwise&gt;
        ...
    &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;c:set&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>设置属性变量var</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:set var="userLevel" scope="session" value="Cowboy" /&gt;

&lt;c:set var="Fido" value="${person.dog}" /&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;c:set var="userLevel" scope="session" &gt;
    Sheriff, Bartender, Cowgirl
&lt;/c:set&gt;</pre>
</div>
</div>
</li>
<li>
<p>设置一个目标性质或值</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:set target="${PetMap}" property="dogName" value="Clover" /&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;c:set target="${person}" property="name" &gt;
    ${foo.name}
&lt;/c:set&gt;</pre>
</div>
</div>
</li>
<li>
<p>要点和技巧</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;c:set&gt;中不能同时有“var”和“target”属性。</p>
</li>
<li>
<p>“scope”是可选的，如果没有，则默认为页面（page）作用域，且标记只在页面作用域中查找一次，不会在所有作用域中搜索。</p>
</li>
<li>
<p>如果“value”计算为null，var指定的属性会被删除。</p>
</li>
<li>
<p>如果“var”指定的属性不存在，则会创建一个属性。</p>
</li>
<li>
<p>如果“target”表达式为null，容器会抛出异常。</p>
</li>
<li>
<p>如果“target”表达式不是一个Map或bean，容器会抛出异常。</p>
</li>
<li>
<p>“target”中要放入一个能解析为实际对象的表达式。不能放入一个String直接量（表示bean或Map的“id”名）。</p>
</li>
<li>
<p>如果“target”表达式是一个bean，这个bean没有与“property”匹配的性质，容器会抛出异常。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:remove&gt;标记</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:remove var="userStatus" scope="request" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注：var必须是String直接量，不能是表达式。scope可选，如果未指定，就会从所有作用域中删除该属性。</p>
</div>
</li>
<li>
<p>&lt;c:import&gt;标记</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:import url="http://www.xxx.com/xxx.html" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注：动态，在请求时增加内容到当前页面。不同于另外两种包含机制，&lt;c:import&gt;中的url可以来自Web容器范围之外。</p>
</div>
</li>
<li>
<p>&lt;c:param&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>使用&lt;c:import&gt;的JSP</p>
<div class="listingblock">
<div class="content">
<pre>...
&lt;c:import url="Header.jsp" &gt;
    &lt;c:param name="subTitle" value="xxx" /&gt;
&lt;/c:import&gt;
...</pre>
</div>
</div>
</li>
<li>
<p>所包含的文件（Header.jsp）</p>
<div class="listingblock">
<div class="content">
<pre>&lt;img src="images/Web-Services.jpg" &gt; &lt;br&gt;
&lt;em&gt;&lt;strong&gt;${param.subTitle}&lt;/strong&gt;&lt;/em&gt;
&lt;br&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:url&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>servlet的URL重写</p>
<div class="listingblock">
<div class="content">
<pre>public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
    response.setContentType("text/html");
    PrintWriter out = response.getWriter();
    HttpSession session = request.getSession();

    out.println("&lt;html&gt;&lt;body&gt;");
    out.println("&lt;a href=\"" + response.encodeURL("/BeerTest.do") + "\"&gt;click&lt;/a&gt;");
    out.println("&lt;/body&gt;&lt;/html&gt;");
}</pre>
</div>
</div>
</li>
<li>
<p>JSP的URL重写</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;html&gt;&lt;body&gt;

This is a hyperlink with URL rewriting enabled.

&lt;a href="&lt;c:url value='/inputComments.jsp' /&gt;"&gt;Click here&lt;/a&gt;

&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>如果URL需要编码，可参考下例：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;c:url value="/inputComments.jsp" var="inputURL" &gt;
    &lt;c:param name="firstName" value="${first}" /&gt;
    &lt;c:param name="lastName" value="${last}" /&gt;
&lt;/c:url&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>使用指令建立错误页面</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>指定的错误页面（“errorPage.jsp”）：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ page isErrorPage="true" %&gt;

&lt;html&gt;&lt;body&gt;
&lt;strong&gt;Bummer.&lt;/strong&gt;
&lt;img src="images/bummerGuy.jpg"&gt;
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>抛出异常的页面（“badPage.jsp”）：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ page errorPage="errorPage.jsp" %&gt;

&lt;html&gt;&lt;body&gt;
About to be bad...
&lt;% int x = 10/0; %&gt;
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>使用&lt;error-page&gt;标记，在DD中为整个应用声明错误页面。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>如果JSP有一个明确的 errorPage page 指令，容器会优先使用指令。</p>
</li>
<li>
<p>声明一个“普遍”型错误页面：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
    &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;
    &lt;location&gt;/errorPage.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
</li>
<li>
<p>为更明确的异常声明一个错误页面：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
    &lt;exception-type&gt;java.lang.ArithmeticException&lt;/exception-type&gt;
    &lt;location&gt;/arithmeticError.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
</li>
<li>
<p>根据HTTP状态码声明一个错误页面：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/notFoundError.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注：&lt;location&gt;必须相对于 web-app 根上下文，所以须以斜线开头。</p>
</div>
</li>
<li>
<p>容器为错误页面提供了一个额外的exception对象，JSP中可以使用EL隐式对象 ${pageContext.exception}。
（非指定的错误页面，无法得到异常对象）。一个更明确的错误页面（errorPage.jsp）如下：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ page isErrorPage="true" %&gt;

&lt;html&gt;&lt;body&gt;
&lt;strong&gt;Bummer.&lt;/strong&gt;&lt;br&gt;

you caused a ${pageContext.exception} on the server.&lt;br&gt;

&lt;img src="images/bummerGuy.jpg"&gt;
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;c:catch&gt;标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>简单例子如下：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ page errorPage="errorPage.jsp" %&gt;
&lt;html&gt;&lt;body&gt;

About to do a risky thing: &lt;br&gt;

&lt;c:catch&gt;
    &lt;% int x = 10/0; %&gt;
&lt;/c:catch&gt;

If you see this, we survived.
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
<li>
<p>访问异常对象的例子：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ page errorPage="errorPage.jsp" %&gt;
&lt;html&gt;&lt;body&gt;

About to do a risky thing: &lt;br&gt;

&lt;c:catch var="myException"&gt;
    &lt;% int x = 10/0; %&gt;
&lt;/c:catch&gt;

&lt;c:if test="${myException != null}"&gt;
    There was an exception: ${myException.message} &lt;br&gt;
&lt;/c:if&gt;

We survived.
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>注：&lt;c:catch&gt;标记更像是Java代码中的try块，抛出异常后，直接跳到&lt;c:catch&gt;标记体的下面。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>要使用定制标记库，必须阅读TLD。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>JSP使用定制标记时，容器调用的方法名必须是 doTag()。定制标记处理器不使用其他定制的方法名。TLD示例如下：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;taglib ...&gt;
...
&lt;uri&gt;randomThings&lt;/uri&gt;
&lt;tag&gt;
    &lt;description&gt;random advice&lt;/description&gt;
    &lt;name&gt;advice&lt;/name&gt;
    &lt;tag-class&gt;foo.AdvisorTagHandler&lt;/tag-class&gt;
    &lt;body-content&gt;empty&lt;/body-content&gt;
    &lt;attribute&gt;
        &lt;name&gt;user&lt;/name&gt;
        &lt;required&gt;true&lt;/required&gt;
        &lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
    &lt;/attribute&gt;
&lt;/tag&gt;
&lt;/taglib ...&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;rtexprvalue&gt;表明属性值是在转换时计算，还是在运行时计算。不设定时（默认值为false），
属性值只能是String直接量，不能是表达式。值为true时，可以使用3种表达式：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 1.EL表达式 --%&gt;
&lt;mine:advice user="${userName}" /&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 2.脚本表达式 --%&gt;
&lt;mine:advice user='&lt;%= request.getAttribute("username") %&gt;' /&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 3.&lt;jsp:attribute&gt;标准动作 --%&gt;
&lt;mine:advice&gt;
    &lt;jsp:attribute name="user"&gt;${userName}&lt;/jsp:attribute&gt;
&lt;/mine:advice&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;body-content&gt;元素的取值范围：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>empty：该标记不能有body</p>
</li>
<li>
<p>scriptless：该标记不能有脚本元素，但可以是模板文本和EL，也可以是定制和标准动作。</p>
</li>
<li>
<p>tagdependent：标记体要看作纯文本，不会计算EL，也不会触发标记/动作。</p>
</li>
<li>
<p>JSP：能放在JSP中的东西都能放在此标记body中。</p>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;body-content&gt;声明为“empty”，仍可以利用&lt;jsp:attribute&gt;在标记体中放属性。</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>外部标记中有3个属性，body中就会有3个&lt;jsp:attribute&gt;标记。</p>
</li>
<li>
<p>&lt;jsp:attribute&gt;自己的属性是“name”。</p>
</li>
</ol>
</div>
</li>
<li>
<p>没有body的标记，有3种调用方法：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 1.空标记 --%&gt;
&lt;mine:advice user="${userName}" /&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 2.开始和结束标记之间没有内容的标记 --%&gt;
&lt;mine:advice user="${userName}"&gt; &lt;/mine:advice&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%-- 3.开始和结束标记之间只有&lt;jsp:attribute&gt;标记 --%&gt;
&lt;mine:advice&gt;
    &lt;jsp:attribute name="user"&gt;${userName}&lt;/jsp:attribute&gt;
&lt;/mine:advice&gt;</pre>
</div>
</div>
</li>
<li>
<p>taglib中的&lt;uri&gt;只是一个名，不是一个位置。</p>
</li>
<li>
<p>JSP 2.0之前，需要在DD中将taglib uri映射到TLD文件：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app&gt;
...
&lt;jsp-config&gt;
    &lt;taglib&gt;
        &lt;taglib-uri&gt;randomThings&lt;/taglib-uri&gt;
        &lt;taglib-location&gt;/WEB-INF/myFunctions.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;
&lt;/jsp-config&gt;
&lt;/web-app&gt;</pre>
</div>
</div>
</li>
<li>
<p>JSP 2.0之后，DD中没有&lt;taglib&gt;项，容器会自动查找并建立TLD和&lt;uri&gt;名之间的映射。</p>
</li>
<li>
<p>容器会在4个位置查找TLD：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>WEB-INF目录</p>
</li>
<li>
<p>WEB-INF的一个子目录</p>
</li>
<li>
<p>WEB-INF/lib下一个JAR文件中的META-INF目录</p>
</li>
<li>
<p>WEB-INF/lib下一个JAR文件中的META-INF目录的子目录</p>
</li>
</ol>
</div>
</li>
<li>
<p>如果JSP使用了多个标记库</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>确保taglib uri唯一。</p>
</li>
<li>
<p>不要使用保留的前缀：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>jsp:</p>
</li>
<li>
<p>jspx:</p>
</li>
<li>
<p>java:</p>
</li>
<li>
<p>javax:</p>
</li>
<li>
<p>servlet:</p>
</li>
<li>
<p>sun:</p>
</li>
<li>
<p>sunw:</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_定制标记开发">1.5. 定制标记开发</h3>
<div class="ulist">
<ul>
<li>
<p>(待补充)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_web应用部署">1.6. Web应用部署</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>把文件放在 WEB-INF 下可以避免直接访问，或者如果应用部署为一个WAR文件，
可以把不允许直接访问的文件放在 META-INF 下。</p>
</li>
<li>
<p>servlet映射</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>简单示例</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app ...&gt;
  ...
  &lt;servlet&gt;
    &lt;servlet-name&gt;Beer&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.example.web.BeerSelect&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Beer&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Beer/SelectBeer.do&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</pre>
</div>
</div>
</li>
<li>
<p>三种&lt;url-pattern&gt;元素</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>完全匹配</p>
</li>
<li>
<p>目录匹配</p>
</li>
<li>
<p>扩展名匹配</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;url-pattern&gt;/Beer/SelectBeer.do&lt;/url-pattern&gt;
&lt;url-pattern&gt;/Beer/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>DD中的URL模式不会映射到&lt;servlet-name&gt;元素以外的其他元素。</p>
</li>
<li>
<p>&lt;servlet-name&gt;是映射的键。</p>
</li>
<li>
<p>客户按&lt;url-pattern&gt;请求servlet，不是按&lt;servlet-name&gt;。</p>
</li>
<li>
<p>匹配的优先顺序是：完全匹配&gt;目录匹配&gt;扩展名匹配。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;welcome-file-list&gt;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>元素中的文件不以斜线开头</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app ...&gt;
  ...
         &lt;welcome-file-list&gt;
                 &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
                 &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
                 &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
                 &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;
                 &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;
                 &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;
         &lt;/welcome-file-list&gt;
...
&lt;/web-app&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>声明一个错误页面</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>“普遍型”错误页面</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
         &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;
         &lt;location&gt;/errorPage.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>可以增加一个有errorPage属性的page指令，覆盖单个JSP的错误页面设置。</p>
</div>
</li>
<li>
<p>更明确异常的错误页面</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
         &lt;exception-type&gt;java.lang.ArithmeticException&lt;/exception-type&gt;
         &lt;location&gt;/arithmeticError.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
</li>
<li>
<p>HTTP状态码的错误页面</p>
<div class="listingblock">
<div class="content">
<pre>&lt;error-page&gt;
         &lt;error-code&gt;404&lt;/error-code&gt;
         &lt;location&gt;/notFoundError.jsp&lt;/location&gt;
&lt;/error-page&gt;</pre>
</div>
</div>
</li>
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>不能在同一个&lt;error-page&gt;标记中同时使用&lt;error-code&gt;和&lt;exception-type&gt;。</p>
</li>
<li>
<p>只要是Throwable，&lt;exception-type&gt;中就可以声明，包括：java.lang.Error、运行时异常和所有受查异常。其中必须使用完全限定类名。</p>
</li>
<li>
<p>可以调用HttpServletResponse的sendError()方法自己生成错误，例如：</p>
<div class="listingblock">
<div class="content">
<pre>//以下两种方法都行
response.sendError(HttpServletResponse.SC_FORBIDDEN);
response.sendError(403);</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>在DD中配置servlet初始化</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>servlet默认会在第一个请求到来时初始化，如果希望部署时即提前加载，可以使用&lt;load-on-startup&gt;元素。</p>
</li>
<li>
<p>非负值就意味着要提早加载，数值越小，优先级越高。</p>
</li>
<li>
<p>数值相等时，按DD中声明的顺序来加载。</p>
</li>
</ol>
</div>
</li>
<li>
<p>XML兼容的JSP：JSP文档</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>正常的JSP是一个页面，除非采用了与正常JSP语法对应的XML语法来编写，这样它就成为一个JSP文档。</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>指令（taglib除外）</p>
<div class="listingblock">
<div class="content">
<pre>// 正常JSP页面语法
&lt;%@ page import=”java.util.*” %&gt;

// JSP文档语法
&lt;jsp:directive.page import=”java.util.*” /&gt;</pre>
</div>
</div>
</li>
<li>
<p>声明</p>
<div class="listingblock">
<div class="content">
<pre>// 正常JSP页面语法
&lt;%! int y = 3; %&gt;

// JSP文档语法
&lt;jsp:declaration&gt;
  int y = 3;
&lt;/jsp:declaration&gt;</pre>
</div>
</div>
</li>
<li>
<p>Scriptlet</p>
<div class="listingblock">
<div class="content">
<pre>// 正常JSP页面语法
&lt;% list.add(“Fred”); %&gt;

// JSP文档语法
&lt;jsp:scriptlet&gt;
  list.add(“Fred”);
&lt;/jsp:scriptlet&gt;</pre>
</div>
</div>
</li>
<li>
<p>文本</p>
<div class="listingblock">
<div class="content">
<pre>// 正常JSP页面语法
There is no spoon.

// JSP文档语法
&lt;jsp:text&gt;
  There is no spoon.
&lt;/jsp:text&gt;</pre>
</div>
</div>
</li>
<li>
<p>脚本表达式</p>
<div class="listingblock">
<div class="content">
<pre>// 正常JSP页面语法
&lt;%= it.next() %&gt;

// JSP文档语法
&lt;jsp:expression&gt;
  it.next()
&lt;/jsp:expression&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>与EJB有关的DD标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>本地bean的引用（本地bean指：客户（这里是一个servlet）和bean必须在同一个JVM中运行）</p>
<div class="listingblock">
<div class="content">
<pre>&lt;ejb-local-ref&gt;
         &lt;ejb-ref-name&gt;ejb/Customer&lt;/ejb-ref-name&gt;
         &lt;ejb-ref-type&gt;Entity&lt;/ejb-ref-type&gt;
         &lt;local-home&gt;com.xxx.CustomerHome&lt;/local-home&gt;
         &lt;local&gt;com.xxx.Customer&lt;/local&gt;
&lt;/ejb-local-ref&gt;</pre>
</div>
</div>
</li>
<li>
<p>远程bean的引用（远程bean指：客户（这里是一个servlet）和bean可能在不同的JVM中运行（可能还在不同的物理主机上））</p>
<div class="listingblock">
<div class="content">
<pre>&lt;ejb-ref&gt;
         &lt;ejb-ref-name&gt;ejb/LocalCustomer&lt;/ejb-ref-name&gt;
         &lt;ejb-ref-type&gt;Entity&lt;/ejb-ref-type&gt;
         &lt;home&gt;com.xxx.CustomerHome&lt;/home&gt;
         &lt;remote&gt;com.xxx.Customer&lt;/remote&gt;
&lt;/ejb-ref&gt;</pre>
</div>
</div>
</li>
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>本地和远程bean DD标记中有两个相同的元素：&lt;ejb-ref-name&gt;列出完成JNDI查找时所用的逻辑查找名。
&lt;ejb-ref-type&gt;描述了这是一个实体bean还是会话bean。</p>
</li>
<li>
<p>远程bean是&lt;ejb-ref&gt;，不是&lt;ejb-remote-ref&gt;。因为最初定义时，根本没有“本地”，那时所有的企业bean都是“远程”的，所以没必要区别。</p>
</li>
<li>
<p>远程bean是&lt;home&gt;，不是&lt;remote-home&gt;，原因同第2点。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>JNDI&lt;env-entry&gt;DD标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>可以把环境项认为是应用可以使用的某种部署时常量，就像servlet和上下文初始化参数一样。</p>
</li>
<li>
<p>部署时，容器读取DD，使用在DD标记中提供的名和值，建立一个JNDI项（假设是一个完全J2EE兼容的应用，不只是一个只有Web容器的服务器）。
声明应用的JNDI环境项举例如下：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;env-entry&gt;
         &lt;env-entry-name&gt;rates/discountRate&lt;/env-entry-name&gt;
         &lt;env-entry-type&gt;java.lang.Integer&lt;/env-entry-type&gt;
         &lt;env-entry-value&gt;10&lt;/env-entry-value&gt;
&lt;/env-entry&gt;</pre>
</div>
</div>
</li>
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;env-entry-type&gt;不能是基本类型，构造函数取一个String或Character参数才可以。</p>
</li>
<li>
<p>还可以包括一个可选的&lt;description&gt;。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;mime-mapping&gt;DD标记</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>声明举例：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;mime-mapping&gt;
         &lt;extension&gt;mpg&lt;/extension&gt;
         &lt;mime-type&gt;video/mpeg&lt;/mime-type&gt;
&lt;/mime-mapping&gt;</pre>
</div>
</div>
</li>
<li>
<p>备注：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>扩展名里没有“.”。</p>
</li>
<li>
<p>不是&lt;file-type&gt;和&lt;content-type&gt;。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>资源部署位置列表</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">资源类型</th>
<th class="tableblock halign-left valign-top">部署位置</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署描述文件（web.xml）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直接放在WEB-INF中</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">标记文件（.tag或.tagx）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果未部署在JAR中，标记文件必须放在WEB-INF/tags中，或WEB-INF/tags的一个子目录中。
如果部署在一个JAR文件中，标记文件则必须放在META-INF/tags或META-INF/tags的一个子目录中。
注意：如果标记文件部署在JAR中，那么JAR中还必须有一个TLD。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML和JSP（可以直接访问的）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户能访问的HTML和JSP可以放在Web根目录下，或者它的任何子目录下，但不能放在WEB-INF下（包括子目录）。
如果在WAR文件中，这些页面不能放在META-INF下（包括子目录）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML和JSP（不允许客户直接访问）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户不能直接访问WEB-INF及WAR文件中的META-INF下的页面。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLD（.tld）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果不在JAR中，TLD文件必须放在WEB-INF中，或者放在WEB-INF的子目录下。如果部署在一个JAR中，
TLD文件必须放在META-INF下，或者META-INF的子目录下。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet类必须放在与包结构匹配的一个目录结构里，置于WEB-INF/classes下的一个目录中（例如，
类com.example.Ring要放在WEB-INF/classes/com/example中），或者放在WEB-INF/lib下一个JAR文件里的适当包结构中。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">标记处理器类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际上，Web应用所用的所有类（除非是类路径上类库的一部分）都必须像servlet类一样遵循同样的规则，要放在WEB-INF/classes下，
而且要有与包结构匹配的目录结构（或者放在WEB-INF/lib下一个JAR文件里的适当包结构中）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAR文件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAR文件必须放在WEB-INF/lib目录中。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_web应用安全">1.7. Web应用安全</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>安全的四大要素</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>认证</p>
</li>
<li>
<p>授权</p>
</li>
<li>
<p>机密性</p>
</li>
<li>
<p>数据完整性</p>
</li>
</ol>
</div>
</li>
<li>
<p>启用认证</p>
<div class="paragraph">
<p>可以在DD中加入如下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
&lt;/login-config&gt;</pre>
</div>
</div>
</li>
<li>
<p>授权</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>定义角色</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>开发商特定：tomcat-users.xml中的&lt;role&gt;元素。</p>
</li>
<li>
<p>Servlet规范：web.xml中的DD&lt;security-role&gt;元素。</p>
</li>
</ol>
</div>
</li>
<li>
<p>定义资源/方法约束</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>DD中的&lt;security-constraint&gt;元素。</p>
</li>
</ol>
</div>
</li>
<li>
<p>举例：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app...&gt;
...
&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;

        &lt;web-resource-name&gt;UpdateRecipes&lt;/web-resource-name&gt;

        &lt;url-pattern&gt;/Beer/AddRecipe/*&lt;/url-pattern&gt;
        &lt;url-pattern&gt;/Beer/ReviewRecipe/*&lt;/url-pattern&gt;

        &lt;http-method&gt;GET&lt;/http-method&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;

    &lt;/web-resource-collection&gt;

    &lt;auth-constraint&gt;
        &lt;role-name&gt;Admin&lt;/role-name&gt;
        &lt;role-name&gt;Member&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
...
&lt;/web-app&gt;</pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;web-resource-collection&gt;子元素的作用是告诉容器哪些资源和HTTP方法组合要以某种方式受约束，即只能由相应&lt;auth-constraint&gt;标记中的角色访问。</p>
</li>
<li>
<p>&lt;web-resource-name&gt;元素是必要的（尽管你自己可能不会用到）。</p>
</li>
<li>
<p>&lt;description&gt;元素是可选的。</p>
</li>
<li>
<p>必须至少指定一个&lt;url-pattern&gt;。</p>
</li>
<li>
<p>&lt;http-method&gt;元素的方法包括：GET，POST，PUT，TRACE，DELETE，HEAD，OPTIONS。</p>
</li>
<li>
<p>如果没有指定任何&lt;http-method&gt;，那么 所有方法 都是受约束的。</p>
</li>
<li>
<p>如果指定了&lt;http-method&gt;，那么只有 指定方法 是受约束的。</p>
</li>
<li>
<p>一个&lt;security-constraint&gt;中可以有多个&lt;web-resource-collection&gt;元素。</p>
</li>
<li>
<p>&lt;auth-constraint&gt;元素应用于&lt;security-constraint&gt;中的所有&lt;web-resource-collection&gt;元素。</p>
</li>
<li>
<p>不是资源本身受到约束，实际上是 资源+HTTP方法组合 受到约束。</p>
</li>
<li>
<p>&lt;security-constraint&gt;中&lt;auth-constraint&gt;子元素的规则：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>&lt;role-name&gt;规则：</p>
<div class="olist upperroman">
<ol class="upperroman" type="I">
<li>
<p>&lt;role-name&gt;元素可选。</p>
</li>
<li>
<p>如果存在&lt;auth-constraint&gt;元素，但是没有任何&lt;role-name&gt;元素，那么所有用户都遭拒绝。</p>
</li>
<li>
<p>如果有&lt;role-name&gt;*&lt;/role-name&gt;，那么所有用户都是允许的。</p>
</li>
<li>
<p>角色名区分大小写。</p>
</li>
</ol>
</div>
</li>
<li>
<p>&lt;auth-constraint&gt;规则：</p>
<div class="olist upperroman">
<ol class="upperroman" type="I">
<li>
<p>&lt;auth-constraint&gt;元素可选。</p>
</li>
<li>
<p>如果存在一个&lt;auth-constraint&gt;，容器必须对相关URL完成认证。</p>
</li>
<li>
<p>如果不存在&lt;auth-constraint&gt;，容器允许不经认证就能访问这些URL。</p>
</li>
<li>
<p>为了提高可读性，可以在&lt;auth-constraint&gt;中增加一个&lt;description&gt;。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>多个&lt;auth-constraint&gt;元素如何交互？</p>
<div class="paragraph">
<p>举例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app...&gt;
...
&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Recipes&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/Beer/DisplayRecipes/*&lt;/url-pattern&gt;
        &lt;url-pattern&gt;/Beer/UpdateRecipes/*&lt;/url-pattern&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;

    &lt;auth-constraint&gt;
        &lt;role-name&gt;【A】&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Recipes&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/Beer/UpdateUsers/*&lt;/url-pattern&gt;
        &lt;url-pattern&gt;/Beer/UpdateRecipes/*&lt;/url-pattern&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;

    &lt;auth-constraint&gt;
        &lt;role-name&gt;【B】&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

...
&lt;/web-app&gt;</pre>
</div>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">角色</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin,Member,Guest</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diane</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">【A】的内容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">【B】的内容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">谁能访问UpdateRecipes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ted,Annie</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">存在且为空标记</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">不存在&lt;auth-constraint&gt;元素</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有人</p></td>
</tr>
</tbody>
</table>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>解释：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>合并单个角色名时，所列的所有角色名都允许访问。</p>
</li>
<li>
<p>角色名“*”与其他设置合并时，所有人都允许访问。</p>
</li>
<li>
<p>空的&lt;auth-constraint&gt;标记与其他设置合并时，所有人都不允许访问。</p>
</li>
<li>
<p>如果某个&lt;security-constraint&gt;中没有&lt;auth-constraint&gt;元素，它与其他设置合并时，所有人都允许访问。</p>
</li>
</ol>
</div>
</li>
<li>
<p>放一个空的&lt;auth-constraint&gt;元素会使任何角色的任何人都不能访问受限资源，这有什么意义？</p>
<div class="paragraph">
<p>【答】没有人能访问是指“Web应用之外的任何人都不允许访问”，Web应用的其他部分是可以的，例如请求分派器。
可以把受限资源想成是Java类中的某种私有方法，仅供内部使用。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>HttpServletRequest中有3个方法与程序式安全有关：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>getUserPrincipal()：主要用于EJB。</p>
</li>
<li>
<p>getRemoteUser()：可以用于检查认证状态，很少使用。</p>
</li>
<li>
<p>isUserInRole()：可以不在HTTP方法层次（GET、POST等）上完成授权，而是对方法中的某些部分建立访问授权（是否允许访问方法中的某一部分）。</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>调用前，用户要得到 认证 ，否则容器总会返回false。</p>
</li>
</ol>
</div>
</li>
<li>
<p>示例</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Servlet：</p>
<div class="listingblock">
<div class="content">
<pre>if( request.isUserInRole("Manager")) {
    // 处理UpdateRecipe页面
    ...
} else {
    // 处理ViewRecipe页面
    ...
}</pre>
</div>
</div>
</li>
<li>
<p>DD：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;web-app...&gt;
    &lt;servlet&gt;
        &lt;security-role-ref&gt;
            &lt;role-name&gt;Manager&lt;/role-name&gt;
            &lt;role-link&gt;Admin&lt;/role-link&gt;
        &lt;/security-role-ref&gt;
        ...
    &lt;/servlet&gt;
    ...
    &lt;security-role&gt;
        &lt;role-name&gt;Admin&lt;/role-name&gt;
    &lt;/security-role&gt;
    ...
&lt;/web-app&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>备注：不管&lt;security-role&gt;中的“Manager”是否实际存在，容器都会先查找&lt;security-role-ref&gt;，把它映射为“Admin”后再查找。</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>四种类型的认证：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>如下四种：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>基本（BASIC）：以一种未加密的编码形式（base64）传输登录信息，安全性很弱。</p>
</li>
<li>
<p>摘要（DIGEST）：安全一些，但由于加密机制没有得到广泛应用，并不要求J2EE容器一定支持。</p>
</li>
<li>
<p>客户证书（CLIENT-CERT）：非常安全，使用了公共秘钥证书（Public Key Certificates）。缺点是：客户必须先有一个证书才能登录系统，
主要用于B2B应用。</p>
</li>
<li>
<p>表单（FORM）：允许利用合法的HTML建立自己的定制登录表单（前三种都使用了浏览器的标准弹出表单来输入用户名和密码）。
四种认证中最不安全的方式，用户名和口令都在HTTP请求中发回，而且未经加密。</p>
</li>
</ol>
</div>
</li>
<li>
<p>除了表单认证，一旦在DD中声明了&lt;login-config&gt;元素，实现认证就将由容器自动处理（假设已经在服务器中配置了用户名/口令/角色信息）。</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">规范</th>
<th class="tableblock halign-left valign-top">数据完整性</th>
<th class="tableblock halign-left valign-top">注释</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BASIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-弱</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP标准，所有浏览器都支持</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIGEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">强一些-但不是SSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对于HTTP和J2EE容器是可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">J2EE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非常弱，没有加密</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许有定制的登录屏幕</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT-CERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">J2EE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">强-公共密钥（PKC）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">很强，但是用户必须有证书</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
<li>
<p>基于表单的认证</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>需要作以下处理：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>在DD中声明&lt;login-config&gt;</p>
<div class="listingblock">
<div class="content">
<pre>&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
    &lt;form-login-config&gt;
        &lt;form-login-page&gt;/loginPage.html&lt;/form-login-page&gt;
        &lt;form-error-page&gt;/loginError.html&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;</pre>
</div>
</div>
</li>
<li>
<p>创建一个HTML登录表单</p>
<div class="listingblock">
<div class="content">
<pre>&lt;!-- loginPage.html --&gt;
Please login ...
&lt;form method="POST" action="j_security_check"&gt;
    &lt;input type="text" name="j_username"&gt;
    &lt;input type="password" name="j_password"&gt;
    &lt;input type="submit" value="Enter"&gt;
&lt;/form&gt;</pre>
</div>
</div>
</li>
<li>
<p>创建一个HTML错误表单</p>
<div class="listingblock">
<div class="content">
<pre>&lt;!-- loginError.html --&gt;
&lt;html&gt;&lt;body&gt;
    Sorry dude, wrong password
&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>HTML登录表单中有3项是与容器通信的关键：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>j_security_check</p>
</li>
<li>
<p>j_username</p>
</li>
<li>
<p>j_password</p>
</li>
</ol>
</div>
</li>
<li>
<p>注意一定要启用SSL或会话跟踪，否则返回登录表单时容器可能不认识。</p>
</li>
</ol>
</div>
</li>
<li>
<p>以声明方式保守地实现数据机密性和完整性</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在&lt;security-constraint&gt;中追加&lt;user-data-constraint&gt;元素</p>
<div class="listingblock">
<div class="content">
<pre>&lt;user-data-constraint&gt;
    &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
&lt;/user-data-constraint&gt;</pre>
</div>
</div>
</li>
<li>
<p>&lt;transport-guarantee&gt;的合法值</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>NONE：默认值，意味着没有数据保护。</p>
</li>
<li>
<p>INTEGRAL：数据在传输过程中不能更改。</p>
</li>
<li>
<p>CONFIDENTIAL：数据在传输过程中不能被别人看到。</p>
<div class="paragraph">
<p>备注：尽管规范里没有要求，但实际中几乎所有容器都使用了SSL来实现可靠传输，这说明INTEGRAL和CONFIDENTIAL的效果是一样的，
任意一个都能同时提供机密性和数据完整性。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>为了确保用户的登录数据能安全地传输到服务器，要对每个可能触发登录过程的受限资源设置一个传输保证。</p>
</li>
<li>
<p>未经认证的客户请求一个受限资源时的对比：</p>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">步骤</th>
<th class="tableblock halign-left valign-top">没有传输保证</th>
<th class="tableblock halign-left valign-top">有机密性传输保证</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">①</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户请求/BuyStuff.jsp（DD中已经配置了&lt;security-constraint&gt;）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户请求/BuyStuff.jsp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">②</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">容器向客户发送一个401响应，告诉浏览器要从用户获得登录信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">容器向客户发送一个301响应，告诉浏览器使用安全传输来完成请求的重定向。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">③</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">浏览器再做请求，这一次会在首部中提供用户登录信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">浏览器再做一次资源请求，不过这次通过安全连接（HTTPS）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">④</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">容器对用户进行认证，对请求授权，…，发送响应。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">容器看到资源是受限的，且用户未经认证，所以开始认证过程，向浏览器发送一个401响应…</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">⑤</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">浏览器再做请求，这一次会在首部中提供用户登录信息，而且请求使用安全连接传送。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_过滤器和包装器">1.8. 过滤器和包装器</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>只有一个过滤器接口：Filter</p>
<div class="paragraph">
<p>没有RequestFilter或ResponseFilter，只有一个Filter。</p>
</div>
</li>
<li>
<p>过滤器是模块化的，可以在DD中配置。过滤器设计为完全自包含，运行顺序也由DD控制。</p>
</li>
<li>
<p>过滤器与servlet相似的3个方面：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>容器知道过滤器API</p>
</li>
<li>
<p>容器管理过滤器的生命周期</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>init()：必须实现，通常只需要保存配置（FilterConfig）对象。</p>
</li>
<li>
<p>destroy()：作具体工作，有3个参数：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>ServletRequest（不是HttpServletRequest）</p>
</li>
<li>
<p>ServletResponse（不是HttpServletResponse）</p>
</li>
<li>
<p>FilterChain</p>
</li>
</ol>
</div>
</li>
<li>
<p>doFilter()：必须实现，但通常为空。</p>
</li>
</ol>
</div>
</li>
<li>
<p>都在DD中声明</p>
</li>
</ol>
</div>
</li>
<li>
<p>过滤器不知道谁来调用它们，也不知道过滤器链中下一个是谁。FilterChain控制过滤器的执行顺序，由DD中指定的filter元素驱动。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>doFilter()方法中调用了chain.doFilter()，是否会造成无限递归？ &#8658; 不会，FilterChain接口的doFilter()与Filter接口的doFilter()不同，主要区别如下：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>FilterChain的doFilter()方法负责明确接下来调用谁的doFilter()方法，如果已经到了链尾，则是确定调用哪个servlet的service()方法。</p>
</li>
<li>
<p>ilter接口的doFilter()方法只完成过滤。</p>
</li>
</ol>
</div>
</li>
<li>
<p>可以认为过滤器”可入栈“</p>
</li>
</ol>
</div>
</li>
<li>
<p>声明过滤器</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>声明过滤器</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;filter&gt;的规则：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>必须有&lt;filter-name&gt;</p>
</li>
<li>
<p>必须有&lt;filter-class&gt;</p>
</li>
<li>
<p>&lt;init-param&gt;可选，可以有多个。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;filter&gt;
    &lt;filter-name&gt;BeerRequest&lt;/filter-name&gt;
    &lt;filter-class&gt;com.example.web.BeerRequestFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;LogFileName&lt;/param-name&gt;
        &lt;param-value&gt;UserLog.txt&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>声明对应URL模式的过滤器映射</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;filter-mapping&gt;的规则：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>必须有&lt;filter-name&gt;，用于链接到适当的&lt;filter&gt;元素。</p>
</li>
<li>
<p>&lt;url-pattern&gt;或&lt;servlet-name&gt;元素这二者必有其一。</p>
</li>
<li>
<p>&lt;url-pattern&gt;元素定义了哪些Web应用资源需要使用该过滤器。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;filter-mapping&gt;
    &lt;filter-name&gt;BeerRequest&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>声明对应Servlet名的过滤器</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>&lt;filter-mapping&gt;的规则：</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>&lt;servlet-name&gt;元素定义了哪个Web应用资源需要使用该过滤器。</p>
<div class="listingblock">
<div class="content">
<pre>&lt;filter-mapping&gt;
    &lt;filter-name&gt;BeerRequest&lt;/filter-name&gt;
    &lt;servlet-name&gt;AdviceServlet&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>确定过滤器顺序的容器规则</p>
<div class="paragraph">
<p>当多个过滤器映射到一个给定资源时，容器会使用以下规则：</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><span class="line-through">先找到与URL模式匹配的所有过滤器。过滤器会按DD中声明的顺序组成一个链。</span></p>
</li>
<li>
<p><span class="line-through">一旦将与URL匹配的所有过滤器都放在链中，容器会用同样的办法确定与DD中&lt;servlet-name&gt;匹配的过滤器。</span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>简而言之：URL匹配的过滤器“先”，servlet匹配的过滤器“后”，按DD中定义的顺序执行。</p>
</div>
</li>
<li>
<p>为通过请求分派请求的Web资源声明一个过滤器映射：</p>
<div class="listingblock">
<div class="content">
<pre>&lt;filter-mapping&gt;
    &lt;filter-name&gt;MonitorFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;

    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;!-- 和/或 --&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;!-- 和/或 --&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;!-- 和/或 --&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;

&lt;/filter-mapping&gt;</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>声明规则：</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>必须有&lt;filter-name&gt;。</p>
</li>
<li>
<p>必须有&lt;url-pattern&gt;或&lt;servlet-name&gt;其中之一。</p>
</li>
<li>
<p>可以有 0 ~ 4 个&lt;dispatcher&gt;。</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>REQUEST值表示对客户的请求启用过滤器。如果没有&lt;dispatcher&gt;元素，则默认为REQUEST。</p>
</li>
<li>
<p>INCLUDE值表示对一个include()调用分派来的请求启用过滤器。</p>
</li>
<li>
<p>FORWARD值表示对一个forward()调用分派来的请求启用过滤器。</p>
</li>
<li>
<p>ERROR值表示对错误处理器调用的资源启用过滤器。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>包装器：创建过滤器时，有4个“便利”类可以更容易的完成任务。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ServletRequestWrapper</p>
</li>
<li>
<p>HttpServletRequestWrapper</p>
</li>
<li>
<p>ServletResponseWrapper</p>
</li>
<li>
<p>HttpServletResponseWrapper</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_模式和struts">1.9. 模式和struts</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>3个最主要的非功能性需求：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>性能</p>
</li>
<li>
<p>模块性</p>
</li>
<li>
<p>灵活性、可维护性和可扩展性</p>
</li>
</ol>
</div>
</li>
<li>
<p>设计原则</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>遵循接口编写代码</p>
</li>
<li>
<p>关注点分离和内聚</p>
</li>
<li>
<p>隐藏复杂性</p>
</li>
<li>
<p>松耦合</p>
</li>
<li>
<p>远程代理</p>
</li>
<li>
<p>增强声明性控制</p>
</li>
</ol>
</div>
</li>
<li>
<p>支持远程模型组件的模式</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_环境变量设置">1.10. 环境变量设置</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Java</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>JAVA_HOME</p>
<div class="paragraph">
<p>安装路径</p>
</div>
<div class="paragraph">
<p>注意：某些环境下引用 %JAVA_HOME% 可能出问题，例如 eclipse 下的 javadoc 。</p>
</div>
</li>
<li>
<p>CLASSPATH</p>
<div class="listingblock">
<div class="content">
<pre>.\;%JAVA_HOME%\lib\tools.jar;%JAVA_HOME%\lib\dt.jar</pre>
</div>
</div>
</li>
<li>
<p>PATH</p>
<div class="listingblock">
<div class="content">
<pre>;%JAVA_HOME%\bin;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Tomcat</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CATALINA_HOME</p>
<div class="paragraph">
<p>安装路径</p>
</div>
</li>
<li>
<p>CLASSPATH</p>
<div class="listingblock">
<div class="content">
<pre>.\;%CATALINA_HOME%\lib;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Ant</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ANT_HOME</p>
<div class="paragraph">
<p>安装路径</p>
</div>
</li>
<li>
<p>PATH</p>
<div class="listingblock">
<div class="content">
<pre>;%ANT_HOME%\bin;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_其他">1.11. 其他</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JavaBean</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>boolean属性命名时，应避免使用“is”开头。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-03-19 16:46:27 UTC
</div>
</div>
<link rel="stylesheet" href="highlight/styles/monokai.min.css">
<script src="highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>