
=== 文件状态变化周期

image:images/file_status_lifecycle.png[file status lifecycle]

=== git


. branch
+
----
// 列出当前所有分支的清单
git branch

// 查看各个分支最后一个提交对象的信息
git branch -v

// 筛选出已经（或尚未）与当前分支合并的分支，可以用 --merged 和 --no-merged 选项
git branch --merged

// 简单地用 git branch -d 删除未合并进来的分支会提示错误
git branch -d branch-testing
// 如果确实想要删除，可以用大写的删除选项 -D 强制执行
git branch -D branch-testing
----


. checkout
+
----
// 要切换到其他分支，可以执行 git checkout 命令
git checkout branch-testing

// 在远程分支的基础上分化出一个新的分支来
git checkout -b serverfix origin/serverfix
// 还可以用 --track 选项简化
git checkout --track origin/serverfix
----


. commit
+
----
// -a:跳过使用暂存区域, -m:message
git commit -a -m 'added new file'

// 撤消刚才的提交操作，可以使用 --amend 选项重新提交：
git commit --amend

// 如果刚才提交时忘了暂存某些修改，可以先补上暂存操作，然后再运行 amend 提交：
git commit -m 'initial commit'
git add forgotten_file
git commit --amend
// 上面的三条命令最终只是产生一个提交，第二个提交命令修正了第一个的提交内容。

// 有两个修改过的文件，想要分开提交，但不小心用 git add 全加到了暂存区域，
// 可以使用 git reset HEAD <file>... 的方式取消暂存
git reset HEAD file.txt
----


. config

.. alias
+
----
// 使用别名后，如果要输入 git commit 只需键入 git ci 即可
git config --global alias.ci commit

// 取消暂存文件
git config --global alias.unstage 'reset HEAD --'
// 以下两条命令等效
git unstage fileA
git reset HEAD fileA

// 查看最后一次的提交信息
git config --global alias.last 'log -1 HEAD'
git last

// 运行某个外部命令，而非 Git 的子命令，只需要在命令前加上 ! 就行
git config --global alias.visual '!gitk'
----

.. gui
+
----
// utf-8
git config --global gui.encoding "utf-8"
----

.. http.proxy
+
----
// 查询
git config --global --get http.proxy

// 设置网址、用户、密码
git config --global http.proxy http://YOUR_PROXY_USERNAME:YOUR_PROXY_PASSWORD@YOUR.PROXY.SERVER:8080

// 重置
git config --global --unset http.proxy
----

.. user
+
----
// 查询
git config --list

// 全局设定
git config --global user.email "YourName@gmail.com"
git config --global user.name "YourName"

// 单项目设定（优先于全局设定）
git config user.email "YourName@gmail.com"
git config user.name "YourName"

// 重置
git config --unset user.name "YourName"
----


. fetch
+
----
// fetch 命令只将远端数据拉到本地仓库，并不自动合并到当前工作分支。
// pull 会将远端分支自动合并到本地仓库中的当前分支。
git fetch [remote-name]
----


. log
+
----
// log很长时，bash画面下方的冒号(:)表示还有内容未显示。
// 【J】：向下一行，【K】：向上一行，【Q】：退出
git log

// -p:显示内容差异，-2:仅显示最近的两次更新
git log -p -2

// 仅显示简要的增改行数统计
git log --stat

// format 可以定制要显示的记录格式，这样的输出便于后期编程提取分析
git log --pretty=format:"%h - %an, %ar : %s"
----
+
[cols="^,"]
|===
|选项 | 说明
|%H | 提交对象（commit）的完整哈希字串
|%h | 提交对象的简短哈希字串
|%T | 树对象（tree）的完整哈希字串
|%t | 树对象的简短哈希字串
|%P | 父对象（parent）的完整哈希字串
|%p | 父对象的简短哈希字串
|%an| 作者（author）的名字
|%ae| 作者的电子邮件地址
|%ad| 作者修订日期（可以用 -date= 选项定制格式）
|%ar| 作者修订日期，按多久以前的方式显示
|%cn| 提交者(committer)的名字
|%ce| 提交者的电子邮件地址
|%cd| 提交日期
|%cr| 提交日期，按多久以前的方式显示
|%s | 提交说明
|===
+
其他常用选项及释义：
+
[cols="^,"]
|===
|选项 | 说明
|-p | 按补丁格式显示每个更新之间的差异。
|--word-diff | 按 word diff 格式显示差异。
|--stat | 显示每次更新的文件修改统计信息。
|--shortstat | 只显示 --stat 中最后的行数修改添加移除统计。
|--name-only | 仅在提交信息后显示已修改的文件清单。
|--name-status | 显示新增、修改、删除的文件清单。
|--abbrev-commit | 仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。
|--relative-date | 使用较短的相对时间显示（比如，“2 weeks ago”）。
|--graph | 显示 ASCII 图形表示的分支合并历史。
|--pretty | 使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。
|--oneline | `--pretty=oneline --abbrev-commit` 的简化用法。
|-(n) | 仅显示最近的 n 条提交
|--since, --after |	仅显示指定时间之后的提交，例如：--since=2.weeks
|--until, --before | 仅显示指定时间之前的提交。
|--author | 仅显示指定作者相关的提交。
|--committer | 仅显示指定提交者相关的提交。
|--grep | 搜索提交说明中的关键字
|--all-match | 要得到同时满足两个选项搜索条件的提交，必须用此选项。否则，满足任意一个条件的提交都会被匹配出来。
|===


. mv
+
----
// 移动文件（重命名）
git mv file_from file_to
// 等效于以下三行命令
mv README.txt README
git rm README.txt
git add README
----


. push
+
----
// 推送本地分支到远程同名分支
git push origin serverfix
// 推送本地分支到远程不同名分支
git push origin serverfix:awesomebranch
----
+
[red yellow-background]*删除远程分支：*
+
----
// 参照 git push [远程名] [本地分支]:[远程分支] 语法，如果省略 [本地分支]，
// 那就等于“在这里提取空白然后把它变成[远程分支]”
git push origin :serverfix
----


. rebase
+
准则：[red yellow-background]*一旦分支中的提交对象发布到公共仓库，就不要对该分支进行衍合操作。*


. remote
+
----
// 查询远程地址（v:verbose）
git remote -v

// 增加远程仓库
git remote add origin http://REMOTE_SERVER:PORT/tfs/Collection/_git/YOUR_PROJECT

// 移除远程仓库
git remote remove origin

// 查看远程仓库信息
git remote show [remote-name]

// 远程仓库的重命名
git remote rename [name-from] [name-to]

// 远程仓库的删除
git remote rm [remote-name]
----


. rm
+
----
// 如果删除之前修改过并且已经放到暂存区域的话，则必须要用强制删除选项：-f
git rm -f file.txt


// 想把文件从Git仓库中删除（亦即从暂存区域移除），但仍希望保留在当前工作目录中。
// 换句话说，仅是从跟踪清单中删除。
git rm --cached file.txt
----


. tag
+
----
// 列出 1.4.2 系列的标签
git tag -l 'v1.4.2.*'

// 创建轻量级标签
git tag v1.4-lw

// 创建一个含附注类型的标签，a:annotated
git tag -a v1.4 -m 'my version 1.4'

// 签署标签，s:signed
git tag -s v1.5 -m 'my signed 1.5 tag'

// 验证标签，v:verify
// 此命令会调用 GPG 来验证签名，需要有签署者的公钥（存放在 keyring 中）
git tag -v [tag-name]

// 后期加注标签，在打标签的时候跟上对应提交对象的校验和（或前几位字符）即可
// git log --pretty=oneline
// 15027957951b64cf874c3557a0f3547bd83b3ff6 Merge branch 'experiment'
// 9fceb02d0ae598e95dc970b74767f19372d61af8 updated rakefile
// 8a5cbc430f1a9c3d00faaeffd07798508422908a updated readme
git tag -a v1.2 9fceb02

// 分享标签，默认情况下，git push 并不会把标签传送到远端服务器上，需使用显式命令
git push origin [tagname]
// 一次推送所有本地新增的标签上去，可以使用 --tags 选项
git push origin --tags
----


== gitk

图形界面，基本上相当于 git log 命令的可视化版本。